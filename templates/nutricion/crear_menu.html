<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" type="image/png" href="static/css/Imagen/fisio_logo.png">
    <title>Menú Nutricional</title>
    <style>
        .menu-container {
            display: flex;
            flex-wrap: nowrap;
        }
        .menu-column {
            flex: 1;
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
            background-color: #fff;
        }
        .menu-column h2 {
            text-align: center;
        }
        .ingredient-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .ingredient-row input {
            margin-right: 5px;
        }
        .ingredient-info {
            margin-left: 5px;
            font-size: 0.9em;
            color: #666;
        }
        .day-totals {
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="navbar" id="navbar">
        <a href="/">Inicio</a>
        <a href="/registro">Registro</a>
        <a href="/consultar">Registro de consultas</a>
        <a href="/agenda">Calendario</a>
        <a href="/agendar_cita">Agendar Cita</a>
        <a href="/historial_citas">Historial de Citas</a>
        <a href="/directorio_pacientes">Directorio Pacientes</a>
        <a href="/expediente">Expediente</a>
    </div>
    <title>Crear Menú</title>
</head>
<body>
    <form method="POST" action="/crear_menu">
        <label for="id_paciente">Paciente:</label>
        <select name="id_paciente" id="id_paciente">
            {% for paciente in pacientes %}
            <option value="{{ paciente.id_paciente }}">{{ paciente.nombres }} {{ paciente.primer_apellido }} {{ paciente.segundo_apellido }}</option>
            {% endfor %}
        </select>

        {% for dia in range(1, 6) %}
            <h3>Día {{ dia }}</h3>
            {% for comida in ['desayuno', 'colacion1', 'almuerzo', 'colacion2', 'cena'] %}
                <h4>{{ comida.capitalize() }}</h4>
                <label for="{{ comida }}_platillo_dia{{ dia }}">Platillo:</label>
                <input type="text" name="{{ comida }}_platillo_dia{{ dia }}" id="{{ comida }}_platillo_dia{{ dia }}">
                
                {% for i in range(1, 6) %}
                    <label for="{{ comida }}_ingredientes_dia{{ dia }}_{{ i }}">Ingrediente {{ i }}:</label>
                    <input type="text" name="{{ comida }}_ingredientes_dia{{ dia }}_{{ i }}" id="{{ comida }}_ingredientes_dia{{ dia }}_{{ i }}">
                    <label for="{{ comida }}_cantidad_dia{{ dia }}_{{ i }}">Cantidad {{ i }}:</label>
                    <input type="text" name="{{ comida }}_cantidad_dia{{ dia }}_{{ i }}" id="{{ comida }}_cantidad_dia{{ dia }}_{{ i }}">
                {% endfor %}
            {% endfor %}
            <label for="total_proteinas_dia{{ dia }}">Total Proteínas:</label>
            <input type="text" name="total_proteinas_dia{{ dia }}" id="total_proteinas_dia{{ dia }}">
            <label for="total_lipidos_dia{{ dia }}">Total Lípidos:</label>
            <input type="text" name="total_lipidos_dia{{ dia }}" id="total_lipidos_dia{{ dia }}">
            <label for="total_kcal_dia{{ dia }}">Total Kcal:</label>
            <input type="text" name="total_kcal_dia{{ dia }}" id="total_kcal_dia{{ dia }}">
            <label for="total_azucar_dia{{ dia }}">Total Azúcar:</label>
            <input type="text" name="total_azucar_dia{{ dia }}" id="total_azucar_dia{{ dia }}">
        {% endfor %}
        
        <button type="submit">Guardar Menú</button>
    </form>
    
    <script>
        function updateIngredientInfo(element) {
            const datalist = document.getElementById('ingredients_list');
            const options = datalist.options;
            let row = element.closest('.ingredient-row');
            let infoSpan = row.querySelector('.ingredient-info');
            let quantityInput = row.querySelector('input[type="number"]');
            let ingredientInput = row.querySelector('input[list="ingredients_list"]');
            
            if (quantityInput && ingredientInput) {
                let quantity = parseFloat(quantityInput.value) || 0;
                
                for (let i = 0; i < options.length; i++) {
                    if (options[i].value === ingredientInput.value) {
                        const group = options[i].getAttribute('data-group');
                        const unit = options[i].getAttribute('data-unit');
                        const grams = parseFloat(options[i].getAttribute('data-grams')) || 0;
                        const kcal = parseFloat(options[i].getAttribute('data-kcal')) || 0;
                        const hco = parseFloat(options[i].getAttribute('data-hco')) || 0;
                        const lipidos = parseFloat(options[i].getAttribute('data-lipidos')) || 0;
                        const proteinas = parseFloat(options[i].getAttribute('data-proteinas')) || 0;
                        const azucar = parseFloat(options[i].getAttribute('data-azucar')) || 0;
                        const totalGrams = grams * quantity;
                        infoSpan.textContent = `Grupo: ${group}, Unidad: ${unit}, Gramos: ${totalGrams.toFixed(2)}`;
                        updateDayTotals(row.closest('.menu-column'), kcal * quantity, hco * quantity, lipidos * quantity, proteinas * quantity, azucar * quantity);
                        break;
                    }
                }
            }
        }
    
        function updateDayTotals(column, kcal, hco, lipidos, proteinas, azucar) {
            let totalsDiv = column.querySelector('.day-totals');
            let totals = totalsDiv.textContent.match(/[\d\.]+/g).map(parseFloat);
            totals[0] += proteinas;
            totals[1] += lipidos;
            totals[2] += kcal;
            totals[3] += hco;
            totals[4] += azucar;
            totalsDiv.textContent = `Proteínas: ${totals[0].toFixed(2)}g, Lípidos: ${totals[1].toFixed(2)}g, Kcal: ${totals[2].toFixed(2)}, HCO: ${totals[3].toFixed(2)}g, Azúcar: ${totals[4].toFixed(2)}g`;
            
            // Actualizar los campos ocultos con los totales
            document.getElementById('total_proteinas').value = totals[0].toFixed(2);
            document.getElementById('total_lipidos').value = totals[1].toFixed(2);
            document.getElementById('total_kcal').value = totals[2].toFixed(2);
            document.getElementById('total_azucar').value = totals[4].toFixed(2);
        }
    </script>
</body>
</html>
